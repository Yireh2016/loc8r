(function(){angular.module("loc8rApp",["ngRoute","ngSanitize","ui.bootstrap"]);function e(e,o){console.log("entro al enrutador ");e.when("/",{templateUrl:"home/home.view.html",controller:"homeCtrl",controllerAs:"vm"}).when("/about",{templateUrl:"common/views/genericText.view.html",controller:"aboutCtrl",controllerAs:"vm"}).when("/location/:locationid",{templateUrl:"/locationDetail/locationDetail.view.html",controller:"locationDetailCtrl",controllerAs:"vm"}).when("/register",{templateUrl:"/auth/register/register.view.html",controller:"registerCtrl",controllerAs:"vm"}).when("/login",{templateUrl:"/auth/login/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"});o.html5Mode({enabled:true,requireBase:false})}angular.module("loc8rApp").config(["$routeProvider","$locationProvider",e])})();(function(){angular.module("loc8rApp").controller("homeCtrl",e);e.$inject=["$scope","loc8rData","geolocation","oldPath"];function e(e,o,t,n){var r=this;r.pageHeader={title:"Loc8r",strapline:"Find places to work with wifi near you!"};r.sidebar={content:"Looking for wifi and a seat? Loc8r helps you find places to work when out and about. Perhaps with coffee, cake or a pint? Let Loc8r help you find the place you're looking for."};n.setPath();r.message="Checking your location";r.getData=function(e){r.message="Searching for nearby places";var t=51.9;lng=-.9151;o.locationByCoords(t,lng).then(function(e){r.message=e.data.length>0?"":"No locations found";r.data={locations:e.data};console.log(r.data.locations)},function(e){r.message="Sorry, something's gone wrong "})};r.showError=function(o){e.$apply(function(){r.message=o.message})};r.noGeo=function(){e.$apply(function(){r.message="Geolocation not supported by this browser."})};t.getPosition(r.getData,r.showError,r.noGeo)}})();(function(){angular.module("loc8rApp").controller("aboutCtrl",e);e.$inject=["oldPath"];function e(e){var o=this;o.pageHeader={title:"About Loc8r"};o.main={content:"Loc8r was created to help people find places to sit down and get a bit of work done.\n\nLorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc sed lorem ac nisi dignissim accumsan. Nullam sit amet interdum magna. Morbi quis faucibus nisi. Vestibulum mollis purus quis eros adipiscing tristique. Proin posuere semper tellus, id placerat augue dapibus ornare. Aenean leo metus, tempus in nisl eget, accumsan interdum dui. Pellentesque sollicitudin volutpat ullamcorper."};e.setPath()}})();(function(){angular.module("loc8rApp").controller("locationDetailCtrl",o);o.$inject=["authentication","$routeParams","loc8rData","$uibModal","oldPath"];function o(o,t,n,r,a){var i=this;i.locationid=t.locationid;i.isLoggedIn=o.isLoggedIn();a.setPath();n.locationById(i.locationid).then(function(e){i.data={location:e.data};i.pageHeader={title:i.data.location.name}},function(o){console.log(e)});i.popupReviewForm=function(){var e=r.open({templateUrl:"/reviewModal/reviewModal.view.html",controller:"reviewModalCtrl as vm",resolve:{locationData:function(){return{locationid:i.locationid,locationName:i.data.location.name}}}});e.result.then(function(e){i.data.location.reviews.push(e)})}}})();(function(){angular.module("loc8rApp").controller("reviewModalCtrl",e);e.$inject=["$uibModalInstance","loc8rData","locationData"];function e(e,o,t){var n=this;n.locationData=t;n.modal={cancel:function(){e.dismiss("cancel")},close:function(o){e.close(o)}};n.doAddReview=function(e,t){o.addReviewById(e,{rating:t.rating,reviewText:t.reviewText}).then(function(e){n.modal.close(e.data)},function(e){n.formError="Your review has not been saved, try again"});return false};n.onSubmit=function(){n.formError="";console.log(n.formData);if(!n.formData.rating||!n.formData.reviewText){n.formError="All fields required, please try again";return false}else{console.log(n.formData);n.doAddReview(n.locationData.locationid,n.formData)}}}})();(function(){angular.module("loc8rApp").controller("registerCtrl",e);e.$inject=["$location","authentication","oldPath"];function e(e,o,t){var n=this;n.pageHeader={title:"Create a new Loc8r account"};n.credentials={name:"",email:"",password:""};console.log("pagina "+t.getPath());n.onSubmit=function(){n.formError="";if(!n.credentials.name||!n.credentials.email||!n.credentials.password){n.formError="All fields required, please try again";return false}else{n.doRegister()}};n.doRegister=function(){n.formError="";o.register({name:n.credentials.name,email:n.credentials.email,password:n.credentials.password}).then(function(n){console.log("el token es  "+n.data.token);o.saveToken(n.data.token);e.url(t.getPath())},function(e){n.formError=e.data.errmsg})}}})();(function(){angular.module("loc8rApp").controller("loginCtrl",e);e.$inject=["$location","authentication","oldPath"];function e(e,o,t){var n=this;n.pageHeader={title:"Login in to Loc8r"};n.credentials={email:"",password:""};n.returnPage=e.search().page||"/";n.onSubmit=function(){n.formError="";if(!n.credentials.email||!n.credentials.password){n.formError="All fields required, please try again";return false}else{n.doLogin()}};n.doLogin=function(){n.formError="";o.login({email:n.credentials.email,password:n.credentials.password}).then(function(n){console.log("el token es  "+n.data.token);o.saveToken(n.data.token);e.url(t.getPath())},function(e){n.formError=e.data.errmsg})}}})();(function(){angular.module("loc8rApp").service("geolocation",e);function e(){var e=function(e,o,t){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(e,o)}else{t()}};return{getPosition:e}}})();(function(){angular.module("loc8rApp").service("loc8rData",e);e.$inject=["$http","authentication"];function e(e,o){var t=function(o,t){return e.get("/api/locations?lng="+t+"&lat="+o+"&maxDistance=999999")};var n=function(o){return e.get("/api/locations/"+o)};var r=function(t,n){return e.post("/api/locations/"+t+"/reviews",n,{headers:{Authorization:"Bearer "+o.getToken()}})};return{locationByCoords:t,locationById:n,addReviewById:r}}})();(function(){angular.module("loc8rApp").service("authentication",e);e.$inject=["$window","$http"];function e(e,o){var t=function(o){console.log("se procedera a guardar el token "+o+" en el local storage");e.localStorage["loc8r-token"]=o};var n=function(){return e.localStorage["loc8r-token"]};var r=function(e){return o.post("/api/register",e)};var a=function(e){return o.post("/api/login",e)};var i=function(){e.localStorage.removeItem("loc8r-token")};var l=function(){var o=n();if(o){var t=JSON.parse(e.atob(o.split(".")[1]));return t.exp>Date.now()/1e3}else{return false}};var c=function(){if(l()){var o=n();var t=JSON.parse(e.atob(o.split(".")[1]));return{email:t.email,name:t.name}}};return{saveToken:t,getToken:n,register:r,login:a,logout:i,isLoggedIn:l,currentUser:c}}})();(function(){angular.module("loc8rApp").service("oldPath",e);e.$inject=["$location"];function e(e){var o="/";var t=function(){return o};var n=function(){o=e.path()};return{setPath:n,getPath:t}}})();(function(){angular.module("loc8rApp").filter("formatDistance",o);var e=function(e){return!isNaN(parseFloat(e))&&isFinite(e)};function o(){return function(o){var t,n;if(o&&e(o)){if(o>1e3){t=parseFloat(o).toFixed(1);n=" km"}else{t=parseInt(o,10);n=" m"}return t+n}else{return"?"}}}})();(function(){angular.module("loc8rApp").filter("addHtmlLineBreaks",e);function e(){return function(e){var o=e.replace(/\n/g,"<br/>");return o}}})();(function(){angular.module("loc8rApp").directive("navigation",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.template.html",controller:"navigationCtrl as navvm"}}})();(function(){angular.module("loc8rApp").controller("navigationCtrl",e);e.$inject=["$route","$location","authentication"];function e(e,o,t){var n=this;n.isLoggedIn=t.isLoggedIn();n.currentUser=t.currentUser();console.log("el usuario logeado es "+JSON.stringify(n.currentUser));n.logout=function(){t.logout();console.log("el usuario esta deslogueado "+o.url());if(o.url()==="/"){e.reload()}else{o.path("/")}}}})();(function(){angular.module("loc8rApp").directive("footerGeneric",e);function e(){return{restrict:"EA",templateUrl:"/common/directives/footerGeneric/footerGeneric.template.html"}}})();(function(){angular.module("loc8rApp").directive("pageHeader",e);function e(){return{restrict:"EA",scope:{content:"=content"},templateUrl:"/common/directives/pageHeader/pageHeader.template.html"}}})();(function(){angular.module("loc8rApp").directive("ratingStars",e);function e(){return{scope:{thisRating:"=rating"},restrict:"EA",templateUrl:"/common/directives/ratingStars/ratingStars.template.html"}}})();